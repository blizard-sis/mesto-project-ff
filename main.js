(()=>{"use strict";function t(t,e,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),i=c.querySelector(".card__image"),s=c.querySelector(".card__like-counter"),l=t._id;return i.src=t.link,i.alt=t.name,c.querySelector(".card__title").textContent=t.name,s.textContent=t.likes.length,i.addEventListener("click",(function(){return r(i.src,i.alt)})),t.owner._id!==e?a.remove():a.addEventListener("click",(function(){return n(c,l)})),t.likes.some((function(t){return t._id===e}))&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(function(){return o(u,s,l)})),c}function e(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o),t.addEventListener("click",r),t.addEventListener("click",c)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),t.removeEventListener("click",r),t.removeEventListener("click",c)}function o(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function r(t){t.target===t.currentTarget&&n(t.target)}function c(t){t.target.classList.contains("popup__close")&&n(t.target.closest(".popup"))}function a(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function u(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function i(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);u(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?a(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),u(n,o,e)}))}))}(e,t)}))}function s(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){a(t,n,e)})),o.disabled=!0,o.classList.add(e.inactiveButtonClass)}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-21",headers:{authorization:"2fa76ba3-f465-44c9-a325-7938e9fd3a37","Content-Type":"application/json"}};function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var p=document.querySelector(".places__list"),f=document.querySelector(".popup_type_new-card"),_=f.querySelector(".popup__form"),m=_.querySelector(".popup__input_type_card-name"),y=_.querySelector(".popup__input_type_url"),h=document.querySelector(".popup_type_image"),v=h.querySelector(".popup__image"),b=h.querySelector(".popup__caption"),S=document.querySelector(".popup_type_edit"),g=S.querySelector(".popup__form"),k=g.querySelector(".popup__input_type_description"),q=g.querySelector(".popup__input_type_name"),C=document.querySelector(".popup_avatar_edit"),L=C.querySelector(".popup__form"),E=L.querySelector(".popup__input_type_url"),j=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__edit-button"),P=document.querySelector(".profile__title"),U=document.querySelector(".profile__image"),T=null,w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__error-visible"};function O(t,e){(function(t){return fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))})(e).then((function(){t.remove()})).catch((function(t){return console.error("Ошибка при удалении карточки: ".concat(t))}))}function B(t,e,n){t.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:l.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n).then((function(n){e.textContent=n.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(t){return console.error("Ошибка при удалении лайка: ".concat(t))})):function(t){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:l.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n).then((function(n){e.textContent=n.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(t){return console.error("Ошибка при добавлении лайка: ".concat(t))}))}function D(t,n){v.src=t,v.alt=n,b.textContent=n,e(h)}A.addEventListener("click",(function(){q.value=P.textContent,k.value=x.textContent,s(g,w),i(w),e(S)})),g.addEventListener("submit",(function(t){t.preventDefault();var e,o=g.querySelector(".popup__button");o.textContent="Сохранение...",(e={name:q.value,about:k.value},fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){P.textContent=t.name,x.textContent=t.about,n(S),g.reset()})).catch((function(t){return console.error("Ошибка при обновлении профиля: ".concat(t))})).finally((function(){o.textContent="Сохранить",s(g,w)}))})),U.addEventListener("click",(function(){s(L,w),i(w),e(C)})),L.addEventListener("submit",(function(t){t.preventDefault();var e,o=L.querySelector(".popup__button");o.textContent="Сохранение...",(e=E.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){U.setAttribute("style","background-image: url(".concat(t.avatar,")")),n(C),L.reset()})).catch((function(t){return console.error("Ошибка при обновлении аватара: ".concat(t))})).finally((function(){o.textContent="Сохранить",s(L,w)}))})),j.addEventListener("click",(function(){s(_,w),i(w),e(f)})),_.addEventListener("submit",(function(e){e.preventDefault();var o,r=_.querySelector(".popup__button");r.textContent="Содание...",(o={name:m.value,link:y.value},fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:o.name,link:o.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(e){n(f);var o=t(e,T,O,B,D);p.prepend(o),_.reset()})).catch((function(t){return console.error("Ошибка при добавлении карточки: ".concat(t))})).finally((function(){r.textContent="Создать",s(_,w)}))})),document.addEventListener("DOMContentLoaded",(function(){Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))]).then((function(e){var n,o,r=(o=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){s=!0,r=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return u}}(n,o)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];P.textContent=c.name,x.textContent=c.about,T=c._id,U.setAttribute("style","background-image: url(".concat(c.avatar,")")),a.forEach((function(e){!function(t,e){e.append(t)}(t(e,T,O,B,D),p)}))})).catch((function(t){console.error("Ошибка при загрузке данных:",t)})),document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated")}))}))})();